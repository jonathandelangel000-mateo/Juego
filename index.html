<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Plataformas Móvil - UI Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background-color: #111; overflow: hidden; touch-action: none; }
        canvas { display: block; margin: 0 auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<script>
    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        backgroundColor: '#000', // Fondo negro base
        scale: {
            mode: Phaser.Scale.FIT,
            autoCenter: Phaser.Scale.CENTER_BOTH
        },
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 1000 }, // Gravedad un poco más fuerte para saltos más rápidos
                debug: false
            }
        },
        scene: { preload: preload, create: create, update: update }
    };

    let player, platforms, door;
    let moveLeft = false, moveRight = false, jump = false;

    const game = new Phaser.Game(config);

    function preload() {
        this.load.image('sky', 'https://labs.phaser.io/assets/skies/space3.png');
        this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
        this.load.image('door', 'https://labs.phaser.io/assets/sprites/columns.png');
        this.load.spritesheet('dude', 'https://labs.phaser.io/assets/sprites/dude.png', { frameWidth: 32, frameHeight: 48 });
    }

    function create() {
        // 1. EL CIELO
        this.add.image(400, 250, 'sky').setScale(1.2); // Cielo un poco más arriba

        // 2. ZONA DE INTERFAZ (Fondo negro abajo para los botones)
        let graphics = this.add.graphics();
        graphics.fillStyle(0x111111, 1); // Gris muy oscuro
        graphics.fillRect(0, 500, 800, 100); // Dibuja la barra inferior (de Y=500 a Y=600)
        
        // Línea separadora neón
        graphics.lineStyle(4, 0x00ff00, 1);
        graphics.beginPath();
        graphics.moveTo(0, 500);
        graphics.lineTo(800, 500);
        graphics.strokePath();

        // 3. PLATAFORMAS (Mundo de Juego - Arriba de la barra negra)
        platforms = this.physics.add.staticGroup();
        
        // SUELO PRINCIPAL: Lo subimos a Y=480 para que no toque los botones
        platforms.create(400, 480, 'ground').setScale(2).refreshBody(); 
        
        // Otras plataformas
        platforms.create(600, 350, 'ground');
        platforms.create(200, 250, 'ground');
        platforms.create(750, 150, 'ground');

        // 4. LA PUERTA (Meta)
        door = this.physics.add.sprite(750, 80, 'door').setScale(0.5);
        door.body.allowGravity = false;

        // 5. PERSONAJE
        player = this.physics.add.sprite(50, 400, 'dude'); // Aparece más arriba
        player.setBounce(0.1);
        player.setCollideWorldBounds(true);
        // Ajustamos el límite del mundo para que no caiga en la zona de botones
        this.physics.world.setBounds(0, 0, 800, 480); 

        // Animaciones
        this.anims.create({ key: 'left', frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }), frameRate: 10, repeat: -1 });
        this.anims.create({ key: 'turn', frames: [ { key: 'dude', frame: 4 } ], frameRate: 20 });
        this.anims.create({ key: 'right', frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }), frameRate: 10, repeat: -1 });

        this.physics.add.collider(player, platforms);

        this.physics.add.overlap(player, door, () => {
            alert("¡Nivel Completado!");
            location.reload();
        }, null, this);

        // --- CREACIÓN DE BOTONES PRO ---
        createControls(this);
    }

    function update() {
        if (moveLeft) {
            player.setVelocityX(-200); // Un poco más rápido
            player.anims.play('left', true);
        } else if (moveRight) {
            player.setVelocityX(200);
            player.anims.play('right', true);
        } else {
            player.setVelocityX(0);
            player.anims.play('turn');
        }

        if (jump && player.body.touching.down) {
            player.setVelocityY(-600);
            jump = false; 
        }
    }

    // --- FUNCIÓN PARA DISEÑAR LOS BOTONES ---
    function createControls(scene) {
        // Estilos
        const colorBase = 0x333333; // Gris botón
        const colorPresionado = 0x666666; // Gris claro
        const bordeColor = 0xffffff;

        // --- BOTÓN IZQUIERDA ---
        let leftBtn = scene.add.container(100, 550); // Posición Y=550 (En la zona negra)
        
        let lCircle = scene.add.circle(0, 0, 40, colorBase).setStrokeStyle(2, bordeColor);
        let lArrow = scene.add.text(-15, -20, '◀', { fontSize: '40px', color: '#00ffff' }); // Flecha Cyan
        leftBtn.add([lCircle, lArrow]);
        
        lCircle.setInteractive();
        lCircle.on('pointerdown', () => { moveLeft = true; lCircle.setFillStyle(colorPresionado); });
        lCircle.on('pointerup', () => { moveLeft = false; lCircle.setFillStyle(colorBase); });
        lCircle.on('pointerout', () => { moveLeft = false; lCircle.setFillStyle(colorBase); });

        // --- BOTÓN DERECHA ---
        let rightBtn = scene.add.container(220, 550);
        
        let rCircle = scene.add.circle(0, 0, 40, colorBase).setStrokeStyle(2, bordeColor);
        let rArrow = scene.add.text(-15, -20, '▶', { fontSize: '40px', color: '#00ffff' });
        rightBtn.add([rCircle, rArrow]);

        rCircle.setInteractive();
        rCircle.on('pointerdown', () => { moveRight = true; rCircle.setFillStyle(colorPresionado); });
        rCircle.on('pointerup', () => { moveRight = false; rCircle.setFillStyle(colorBase); });
        rCircle.on('pointerout', () => { moveRight = false; rCircle.setFillStyle(colorBase); });

        // --- BOTÓN SALTO (JUMP) ---
        let jumpBtn = scene.add.container(700, 550);
        
        let jCircle = scene.add.circle(0, 0, 45, 0xaa0000).setStrokeStyle(2, bordeColor); // Rojo
        let jText = scene.add.text(-25, -15, 'JUMP', { fontSize: '20px', fontStyle:'bold', color: '#ffffff' });
        jumpBtn.add([jCircle, jText]);

        jCircle.setInteractive();
        jCircle.on('pointerdown', () => { jump = true; jCircle.setFillStyle(0xff0000); jCircle.setScale(0.9); }); // Efecto de achicarse
        jCircle.on('pointerup', () => { jump = false; jCircle.setFillStyle(0xaa0000); jCircle.setScale(1); });
        jCircle.on('pointerout', () => { jump = false; jCircle.setFillStyle(0xaa0000); jCircle.setScale(1); });
    }
</script>

</body>
</html>
