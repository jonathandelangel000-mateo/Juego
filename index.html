<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Plataformas M√≥vil - Nivel 1</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background-color: #111; overflow: hidden; touch-action: none; }
        canvas { display: block; margin: 0 auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<script>
    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        backgroundColor: '#000',
        scale: {
            mode: Phaser.Scale.FIT,
            autoCenter: Phaser.Scale.CENTER_BOTH
        },
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 1200 }, // Gravedad m√°s fuerte para que se sienta pesado y realista
                debug: false // Cambia a true si quieres ver las cajas verdes de colisi√≥n
            }
        },
        scene: { preload: preload, create: create, update: update }
    };

    let player, platforms, door;
    let moveLeft = false, moveRight = false, jump = false;

    const game = new Phaser.Game(config);

    function preload() {
        this.load.image('sky', 'https://labs.phaser.io/assets/skies/space3.png');
        this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
        this.load.spritesheet('dude', 'https://labs.phaser.io/assets/sprites/dude.png', { frameWidth: 32, frameHeight: 48 });
    }

    function create() {
        // 1. FONDO
        this.add.image(400, 250, 'sky').setScale(1.2);

        // 2. CREAMOS LA PUERTA (Dibujada con c√≥digo para que se vea bien)
        // Usamos un contenedor para agrupar las partes de la puerta
        door = this.add.container(750, 80);
        
        // Marco de la puerta
        let doorFrame = this.add.rectangle(0, 0, 50, 70, 0x555555).setStrokeStyle(2, 0xaaaaaa);
        // Interior de la puerta (Oscuro/Misterioso)
        let doorInner = this.add.rectangle(0, 0, 40, 60, 0x331111);
        // Perilla
        let doorKnob = this.add.circle(15, 5, 3, 0xffd700); // Dorada
        // Texto "EXIT" peque√±o
        let exitText = this.add.text(-18, -45, 'EXIT', { fontSize: '12px', color: '#0f0', fontStyle: 'bold' });

        door.add([doorFrame, doorInner, doorKnob, exitText]);
        
        // Agregamos f√≠sica a la puerta manualmente
        this.physics.world.enable(door);
        door.body.setAllowGravity(false);
        door.body.setImmovable(true);
        door.body.setSize(40, 60); // Ajustamos el tama√±o de la colisi√≥n

        // 3. PLATAFORMAS
        platforms = this.physics.add.staticGroup();
        
        // SUELO PRINCIPAL: Lo bajamos un poco para que coincida con el borde de la UI
        // La imagen 'ground' mide 400x32. Al escalar x2 mide 800x64.
        // Si lo ponemos en Y=532, su borde superior estar√° en 500 (justo donde empieza lo negro).
        platforms.create(400, 532, 'ground').setScale(2).refreshBody(); 
        
        // Plataformas flotantes (Ruta hacia la puerta)
        platforms.create(600, 400, 'ground');
        platforms.create(200, 300, 'ground');
        platforms.create(750, 180, 'ground'); // Plataforma final bajo la puerta

        // 4. PERSONAJE
        player = this.physics.add.sprite(50, 400, 'dude'); // Aparece en el aire para caer al suelo
        player.setBounce(0.1);
        
        // L√çMITE DEL MUNDO: 
        // Importante: El mundo de f√≠sica termina en Y=500 (donde empieza la barra negra)
        this.physics.world.setBounds(0, 0, 800, 500); 
        player.setCollideWorldBounds(true);

        // Animaciones
        this.anims.create({ key: 'left', frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }), frameRate: 10, repeat: -1 });
        this.anims.create({ key: 'turn', frames: [ { key: 'dude', frame: 4 } ], frameRate: 20 });
        this.anims.create({ key: 'right', frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }), frameRate: 10, repeat: -1 });

        this.physics.add.collider(player, platforms);

        // Colisi√≥n con la puerta (usamos overlap para que no rebote, solo detecte)
        this.physics.add.overlap(player, door, () => {
            alert("¬°Nivel Completado! üö™üèÉ‚Äç‚ôÇÔ∏è");
            location.reload(); 
        }, null, this);

        // 5. INTERFAZ (HUD) - Botones Bonitos
        createInterface(this);
    }

    function update() {
        // Reseteamos velocidad horizontal
        player.setVelocityX(0);

        if (moveLeft) {
            player.setVelocityX(-200);
            player.anims.play('left', true);
        } else if (moveRight) {
            player.setVelocityX(200);
            player.anims.play('right', true);
        } else {
            player.anims.play('turn');
        }

        // L√≥gica de salto corregida
        // player.body.blocked.down detecta si est√° tocando suelo f√≠sico
        // player.body.touching.down detecta colisiones activas
        if (jump && (player.body.touching.down || player.body.blocked.down)) {
            player.setVelocityY(-650); // Impulso de salto
            jump = false; // Reset inmediato para evitar saltos m√∫ltiples raros
        }
    }

    function createInterface(scene) {
        // --- BARRA INFERIOR ---
        let graphics = scene.add.graphics();
        // Fondo Negro Brillante (Estilo Pl√°stico)
        graphics.fillStyle(0x0a0a0a, 1);
        graphics.fillRect(0, 500, 800, 100);
        // L√≠nea Ne√≥n Divisoria
        graphics.lineStyle(4, 0x00ff00);
        graphics.lineBetween(0, 500, 800, 500);

        // --- BOT√ìN IZQUIERDA ---
        let btnL = scene.add.container(100, 550);
        // C√≠rculo base con degradado falso (dos c√≠rculos)
        btnL.add(scene.add.circle(0, 0, 40, 0x333333).setStrokeStyle(2, 0x555555));
        btnL.add(scene.add.circle(0, -2, 35, 0x444444)); // Brillo superior
        // Flecha
        let arrowL = scene.add.text(-12, -20, '<', { fontSize: '40px', color: '#00ffff', fontStyle: 'bold' });
        btnL.add(arrowL);
        
        let hitL = scene.add.circle(0, 0, 45, 0x000000, 0).setInteractive(); // Hitbox invisible m√°s grande
        hitL.on('pointerdown', () => { moveLeft = true; btnL.y += 2; }); // Efecto visual de presionar
        hitL.on('pointerup', () => { moveLeft = false; btnL.y -= 2; });
        hitL.on('pointerout', () => { moveLeft = false; btnL.y -= 2; });
        btnL.add(hitL); // Agregamos el hitbox al contenedor

        // --- BOT√ìN DERECHA ---
        let btnR = scene.add.container(220, 550);
        btnR.add(scene.add.circle(0, 0, 40, 0x333333).setStrokeStyle(2, 0x555555));
        btnR.add(scene.add.circle(0, -2, 35, 0x444444));
        let arrowR = scene.add.text(-12, -20, '>', { fontSize: '40px', color: '#00ffff', fontStyle: 'bold' });
        btnR.add(arrowR);

        let hitR = scene.add.circle(0, 0, 45, 0x000000, 0).setInteractive();
        hitR.on('pointerdown', () => { moveRight = true; btnR.y += 2; });
        hitR.on('pointerup', () => { moveRight = false; btnR.y -= 2; });
        hitR.on('pointerout', () => { moveRight = false; btnR.y -= 2; });
        btnR.add(hitR);

        // --- BOT√ìN SALTO (JUMP) ---
        let btnJ = scene.add.container(700, 550);
        // Base Roja
        btnJ.add(scene.add.circle(0, 0, 45, 0x990000).setStrokeStyle(3, 0xffcccc));
        btnJ.add(scene.add.circle(0, -3, 40, 0xcc0000)); // Efecto 3D
        let textJ = scene.add.text(-28, -15, 'JUMP', { fontSize: '22px', color: '#fff', fontStyle: 'bold' });
        btnJ.add(textJ);

        let hitJ = scene.add.circle(0, 0, 50, 0x000000, 0).setInteractive();
        hitJ.on('pointerdown', () => { jump = true; btnJ.y += 4; }); // Se hunde m√°s
        hitJ.on('pointerup', () => { jump = false; btnJ.y -= 4; });
        hitJ.on('pointerout', () => { jump = false; btnJ.y -= 4; });
        btnJ.add(hitJ);
    }
</script>

</body>
</html>
